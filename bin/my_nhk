#!/usr/bin/env mksh
#
#
ACTION="[none]"
if [[ ! -z "$@" ]]; then
  ACTION="$1"; shift
fi

set -u -e -o pipefail
THE_ARGS="$@"
THIS_DIR="$(dirname "$(dirname "$(realpath "$0")")")"
PATH="$PATH:$THIS_DIR/../mksh_setup/bin"
PATH="$PATH:$THIS_DIR/../sh_color/bin"
PATH="$PATH:$THIS_DIR/bin"

case $ACTION in

  help|--help|-h)
    PATH="$PATH:$THIS_DIR/../mksh_setup/bin"
    mksh_setup print-help $0 "$@"
    ;;

  *)

    mkdir -p "$THIS_DIR/tmp/schedules"
    mkdir -p "$THIS_DIR/tmp/skips"

    FUNC_FILE="$THIS_DIR/bin/public/${ACTION}/_.sh"

    if [[ ! -s  "$FUNC_FILE"  ]]; then
      FUNC_FILE="$THIS_DIR/bin/public/my_nhk/_.sh"
      source "$FUNC_FILE"
      my_nhk "$ACTION" "$@"
      exit 0
    fi

    if [[ -s  "$FUNC_FILE"  ]]; then
      source "$FUNC_FILE"
      "$ACTION" "$@"
      exit 0
    fi

    BIN_FILE="$THIS_DIR/bin/lib/${ACTION}.sh"
    if [[ -s "$BIN_FILE" ]]; then
      source "$BIN_FILE"
      "$ACTION" "$@"
      exit 0
    fi

    # === It's an error:
    echo "!!! Unknown action: $ACTION" 1>&2
    exit 1
    ;;

esac
